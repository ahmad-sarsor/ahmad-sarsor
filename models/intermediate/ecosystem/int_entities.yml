version: 2

models:
  - name: int_entities
    description: |
      Unified entities table containing all entity types (Companies, Investors, Hubs, Academia, etc.)
      enriched with classification metadata, member counts, follower counts, and platform data.
      This is the core intermediate model that feeds all entity-related marts.

    config:
      tags: ["product_analytics", "ecosystem"]
      contract:
        enforced: true
    
    constraints:
      - type: primary_key
        columns: [entity_id]
        warn_unenforced: false

    columns:
      # SECTION 1: BASIC ENTITY INFORMATION
      - name: entity_id
        description: Unique identifier for the entity.
        data_type: string
        constraints:
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: entity_name
        description: Name of the entity.
        data_type: string

      - name: entity_url_name
        description: URL-friendly name used in Finder URLs.
        data_type: string

      - name: entity_full_url
        description: Full relative URL path to the entity profile.
        data_type: string

      - name: entity_finder_url
        description: Complete Finder URL to the entity profile.
        data_type: string

      - name: entity_description
        description: Full description of the entity.
        data_type: string

      - name: entity_tagline
        description: Short tagline or elevator pitch.
        data_type: string

      - name: entity_type
        description: |
          Type of entity: Company, Investor, Hub, Academia, Government, etc.
          Note: 'Startup' is normalized to 'Company'.
        data_type: string

      - name: entity_sub_type
        description: Sub-type within the entity type (e.g., VC, Angel, Corporate VC for Investors).
        data_type: string

      - name: representing_of_id
        description: ID of the parent entity this entity represents (corporate arm).
        data_type: string

      - name: representing_of_name
        description: Name of the parent entity this entity represents.
        data_type: string

      - name: investor_arm
        description: ID of the investor arm associated with this entity.
        data_type: string

      - name: investor_arm_name
        description: Name of the investor arm associated with this entity.
        data_type: string

      # SECTION 2: BUSINESS CLASSIFICATION & SECTOR INFORMATION
      - name: primary_sector_name
        description: Primary sector name from classification taxonomy.
        data_type: string

      - name: primary_sector_short_name
        description: Abbreviated sector name for display purposes.
        data_type: string

      - name: primary_sector_parent
        description: |
          Parent sector of the primary sector.
          Null if the primary sector is itself a root sector.
        data_type: string

      - name: primary_sector_key
        description: Classification key for the primary sector.
        data_type: string

      - name: academia_category
        description: Category for academia entities.
        data_type: string

      # SECTION 3: BUSINESS STAGE & DEVELOPMENT
      - name: internal_funding_stage
        description: Internal funding stage classification.
        data_type: string

      - name: public_funding_stage
        description: Publicly displayed funding stage.
        data_type: string

      - name: product_stage
        description: Product development stage (Concept, Development, Live, etc.).
        data_type: string

      - name: entity_status
        description: Current status of the entity.
        data_type: string

      - name: entity_full_status
        description: Full status description of the entity.
        data_type: string

      - name: is_active
        description: Whether the entity is currently active (1) or closed (0).
        data_type: int64

      # SECTION 4: GEOGRAPHIC INFORMATION
      - name: entity_country
        description: Country where the entity is headquartered.
        data_type: string

      - name: is_israeli
        description: Whether the entity is Israeli-based (1) or not (0).
        data_type: int64

      - name: in_israel_since_year
        description: Year the entity established presence in Israel.
        data_type: int64

      - name: in_israel_since_month
        description: Month the entity established presence in Israel.
        data_type: int64

      - name: headquarter_address
        description: Full headquarters address.
        data_type: string

      # SECTION 5: FINANCIAL & INVESTMENT DATA
      - name: founded_year
        description: Year the entity was founded.
        data_type: int64

      - name: founded_month
        description: Month the entity was founded.
        data_type: int64
        
      - name: founded_date
        description: date when the entity was founded.
        data_type: date  

      - name: closed_date
        description: Date when the entity was closed (if applicable).
        data_type: date

      - name: closed_year
        description: Year when the entity was closed.
        data_type: int64

      - name: closed_month
        description: Month when the entity was closed.
        data_type: int64

      - name: internal_amount_raised
        description: Total amount raised (internal tracking, in USD).
        data_type: int64

      - name: public_amount_raised
        description: Publicly disclosed amount raised (in USD).
        data_type: int64

      - name: capital_managed
        description: Total capital under management (for investors, in USD).
        data_type: int64

      - name: market_cap
        description: Market capitalization for public companies (in USD).
        data_type: int64

      - name: arms
        description: Comma-separated list of corporate arms associated with this entity.
        data_type: string

      - name: market_cap_update
        description: Date when market cap was last updated.
        data_type: datetime

      # SECTION 6: OPERATIONAL DATA
      - name: israeli_employees_range
        description: Employee count range in Israel.
        data_type: string

      - name: israeli_employees_exact
        description: Exact employee count in Israel.
        data_type: int64

      - name: global_employees_range
        description: Global employee count range.
        data_type: string

      - name: global_employees_exact
        description: Exact global employee count.
        data_type: int64

      - name: num_members
        description: Total number of team members associated with the entity.
        data_type: int64

      - name: num_claimed_members
        description: Number of team members who have claimed their profiles.
        data_type: int64

      - name: num_followers
        description: |
          Number of unique users who added this entity to their watchlist.
          Counted by distinct owner_id from collection_company_relation.
        data_type: int64

      # Digital Presence
      - name: entity_website
        description: Entity homepage URL.
        data_type: string

      - name: entity_careers_page
        description: URL to the entity's careers page.
        data_type: string

      - name: entity_teams_page
        description: URL to the entity's team page.
        data_type: string

      - name: entity_email_domain
        description: Primary email domain of the entity.
        data_type: string

      # Media Assets
      - name: entity_logo
        description: Logo file name.
        data_type: string

      - name: entity_logo_url
        description: Full URL to the entity logo image.
        data_type: string

      # SECTION 7: BUSINESS METRICS & SCORES
      - name: confidence_score
        description: Data confidence score for the entity.
        data_type: int64

      - name: confidence_score_reason
        description: Explanation for the confidence score.
        data_type: string

      # SECTION 8: PLATFORM & METADATA
      - name: creator_id
        description: ID of the user who created the entity record.
        data_type: string

      - name: creator_email
        description: Email of the user who created the entity record.
        data_type: string

      - name: creator_name
        description: Full name of the user who created the entity record.
        data_type: string

      - name: created_date
        description: Date when the entity record was created.
        data_type: date

      - name: updater_id
        description: ID of the user who last updated the record.
        data_type: string

      - name: updated_date
        description: Date when the record was last updated.
        data_type: date

      - name: last_modifier_id
        description: ID of the user who last modified the record.
        data_type: string

      - name: last_modified_date
        description: Date when the record was last modified.
        data_type: date

      # Verification & BI Data
      - name: bi_verify_key
        description: Key of the BI user who verified the entity data.
        data_type: string

      - name: bi_verify_email
        description: Email of the BI user who verified the entity data.
        data_type: string

      - name: bi_verify_name
        description: Name of the BI user who verified the entity data.
        data_type: string

      - name: bi_verify_date
        description: Date when the entity data was verified by BI.
        data_type: date

      - name: sector_verify_key
        description: Key of the user who verified the sector classification.
        data_type: string

      - name: sector_verify_date
        description: Date when the sector was verified.
        data_type: date

      # Platform Management
      - name: is_claimed
        description: Whether the entity profile has been claimed (1) or not (0).
        data_type: int64

      - name: claimed_date
        description: Date when the profile was claimed.
        data_type: date

      - name: is_minimal_profile
        description: Whether this is a minimal profile with limited data.
        data_type: int64

      # Legacy Keys & External IDs
      - name: register_id
        description: Israeli company registry ID.
        data_type: string

      - name: crunchbase_id
        description: Crunchbase identifier for the entity.
        data_type: string

      - name: user_key
        description: Legacy user key for angel investors.
        data_type: string

      - name: angel_user_email
        description: Email of the angel investor (for angel type entities).
        data_type: string

      - name: angel_user_name
        description: Full name of the angel investor.
        data_type: string

      - name: hide_reason_id
        description: ID of the reason for hiding the entity profile.
        data_type: string

      - name: hide_reason
        description: Human-readable reason for hiding the entity profile.
        data_type: string

      - name: disclosure_level
        description: |
          Data disclosure level for reports and aggregations:
          - all: Publish name and include in calculations
          - aggregation: Include in calculations only (no name)
          - none: Exclude entirely from reports
        data_type: string

      - name: closed_reason
        description: Reason for entity closure from ClosingEvent (e.g., Acquired, Shut Down, Merged, etc.).
        data_type: string

      - name: business_model
        description: Company business models (e.g., B2B, B2C, SaaS), comma-separated
        data_type: STRING

      - name: geographic_markets
        description: Company target markets (e.g., North America, Europe), comma-separated
        data_type: STRING

      - name: common_misspellings
        description: Comma-separated list of alternative names, spelling variations, 
          and former names for the entity
          Used for fuzzy matching and search.
        data_type: STRING